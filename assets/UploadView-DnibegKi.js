import{_ as M,c as N,a as d,b as l,w as t,r as s,o as U,d as n,e as _,i as B,E as r}from"./index-T5rvRlfQ.js";const E={class:"upload-page"},R={class:"upload-container"},C="http://localhost:8080/api/comp/file/upload",$={__name:"UploadView",setup(h){const a=B({workId:""}),w={workId:[{required:!0,message:"请输入作品ID",trigger:"blur"}],file:[{required:!0,validator:(o,e,p)=>{i.value.length===0?p(new Error("请选择要上传的文件")):p()},trigger:"change"}]},f=_(null),u=_(null),i=_([]),I=o=>o.name.startsWith(a.workId+"_")?!0:(r.error(`文件名格式错误！应为：${a.workId}_队伍名称`),!1),g=o=>o.size/1024/1024<200?a.workId?!!I(o):(r.error("请先填写作品ID！"),!1):(r.error("文件大小不能超过200MB！"),!1),k=()=>{f.value.validate(o=>{if(o){if(i.value.length===0){r.warning("请先选择文件！");return}u.value.submit()}else r.error("请完善表单信息！")})},b=o=>{o.code===200?(r.success(`作品上传成功！作品ID：${o.data}`),v()):r.error(`上传失败：${o.message}`)},x=o=>{let e="网络异常，请重试";o.response&&o.response.data&&(e=o.response.data.message||e),r.error(`上传失败：${e}`)},v=()=>{f.value.resetFields(),i.value=[],u.value&&u.value.clearFiles()};return(o,e)=>{const p=s("el-input"),c=s("el-form-item"),m=s("el-button"),V=s("el-upload"),F=s("el-form"),y=s("el-card");return U(),N("div",E,[d("div",R,[e[5]||(e[5]=d("h2",{class:"page-title"},"作品提交",-1)),l(y,{class:"upload-card"},{default:t(()=>[l(F,{model:a,rules:w,ref_key:"uploadFormRef",ref:f,"label-width":"100px",class:"upload-form"},{default:t(()=>[l(c,{label:"作品ID：",prop:"workId"},{default:t(()=>[l(p,{modelValue:a.workId,"onUpdate:modelValue":e[0]||(e[0]=D=>a.workId=D),placeholder:"请输入报名成功后获取的作品ID"},null,8,["modelValue"])]),_:1}),l(c,{label:"作品文件：",prop:"file"},{default:t(()=>[l(V,{class:"upload-demo",ref_key:"uploadRef",ref:u,action:C,data:{workId:a.workId},"file-list":i.value,"before-upload":g,"on-success":b,"on-error":x,limit:1,"auto-upload":!1,accept:".zip,.rar,.doc,.docx,.pdf"},{default:t(()=>[l(m,{type:"primary"},{default:t(()=>[...e[1]||(e[1]=[n("选择文件",-1)])]),_:1}),e[2]||(e[2]=d("div",{slot:"tip",class:"el-upload__tip"},[n(" 支持格式：zip/rar、doc/docx、pdf"),d("br"),n(" 单个文件不超过200MB，文件命名格式：作品ID_队伍名称"),d("br")],-1))]),_:1},8,["data","file-list"])]),_:1}),l(c,null,{default:t(()=>[l(m,{type:"primary",onClick:k},{default:t(()=>[...e[3]||(e[3]=[n("提交作品",-1)])]),_:1}),l(m,{onClick:v},{default:t(()=>[...e[4]||(e[4]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])}}},L=M($,[["__scopeId","data-v-91643755"]]);export{L as default};
