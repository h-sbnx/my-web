import{_ as Q,c as k,a as b,b as e,w as a,r as V,o as j,d as n,t as p,h as E,j as $,e as y,E as f,k as C,i as H,l as B}from"./index-C6xAr2tu.js";const J={class:"apply-page"},K={class:"query-container"},X={class:"apply-container"},Y={key:0,class:"query-result"},Z={class:"result-section"},ee={class:"result-section"},le={key:2,class:"empty-tip"},ae={key:1,class:"empty-result"},te={class:"apply-container"},oe={class:"member-table-wrap"},re="/file/upload",ue={__name:"ApplyView",setup(de){const q=y(""),w=y(""),d=y(null),N=y(!1),I=y(!1),U=y({}),o=H({groupType:"",teamName:"",projectName:"",school:"",major:"",members:[{name:"",gender:"",college:"",majorGrade:"",studentType:"",phone:"",email:"",photoList:[]}],teacher1:{name:"",gender:"",position:"",title:"",unit:"",email:"",phone:""},teacher2:{name:"",gender:"",position:"",title:"",unit:"",email:"",phone:""}}),L={groupType:[{required:!0,message:"请选择参赛组别",trigger:"change"}],teamName:[{required:!0,message:"请输入队伍名称",trigger:"blur"}],projectName:[{required:!0,message:"请输入项目名称",trigger:"blur"}],school:[{required:!0,message:"请输入报名学校",trigger:"blur"}],major:[{required:!0,message:"请输入参赛专业",trigger:"blur"}],members:[{required:!0,validator:(m,l,r)=>{let u=!0;if(l.forEach((s,_)=>{s.name?!s.phone||!/^1[3-9]\d{9}$/.test(s.phone)?(r(new Error(`第${_+1}名队员手机号不能为空且格式正确`)),u=!1):!s.gender||!s.college||!s.majorGrade||!s.studentType?(r(new Error(`请完善第${_+1}名队员的所有必填信息`)),u=!1):s.photoList.length===0&&(r(new Error(`第${_+1}名队员需上传学生证照片`)),u=!1):(r(new Error(`第${_+1}名队员姓名不能为空`)),u=!1)}),!u)return;if(l.length<1){r(new Error("参赛队员至少需要1人"));return}let i=0;if(o.teacher1.name&&i++,o.teacher2.name&&i++,i<1){r(new Error("至少需要填写1位指导教师的姓名"));return}if(l.length+i>5){r(new Error(`队员(${l.length}人)+指导教师(${i}人)总人数不能超过5人`));return}r()},trigger:"change"}],"teacher1.name":[{required:!0,message:"请输入指导教师1姓名",trigger:"blur"}],"teacher1.gender":[{required:!0,message:"请选择指导教师1性别",trigger:"change"}],"teacher1.unit":[{required:!0,message:"请输入指导教师1单位",trigger:"blur"}],"teacher1.phone":[{required:!0,message:"请输入指导教师1电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},R=y(null),G=()=>{const m=(o.teacher1.name?1:0)+(o.teacher2.name?1:0);if(o.members.length+m>=5){f.warning("队员+指导教师总人数不能超过5人，无法新增队员");return}if(o.members.length>=5){f.warning("每队最多5名队员");return}o.members.push({name:"",gender:"",college:"",majorGrade:"",studentType:"",phone:"",email:"",photoList:[]})},F=m=>{B.confirm("确定要删除该队员吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.members.splice(m,1),delete U.value[m],f.success("队员删除成功")}).catch(()=>{f.info("已取消删除")})},A=async(m,l)=>m?(U.value[l]=m,o.members[l].photoList=[{name:m.name,url:URL.createObjectURL(m)}],f.success("照片已选择，提交时会自动上传"),!0):(f.error("请选择要上传的照片"),!1),M=async()=>{if(Object.keys(U.value).length===0)return!0;try{for(const[m,l]of Object.entries(U.value)){const r=new FormData;r.append("file",l),r.append("workId",q.value);const i=(await C.post("/file/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data;if(i.code!==200)throw new Error(`第${Number(m)+1}名队员照片上传失败：${i.message||"服务器异常"}`);o.members[m].photoList=[i.data]}return!0}catch(m){return f.error(m.message||"照片批量上传失败"),!1}},P=()=>{R.value.validate(async m=>{if(!m){f.error("请完善表单必填信息");return}try{f.info("正在生成作品ID...");const r=(await C.get("/team/generateWorkId")).data;if(r.code!==200){f.error(`作品ID生成失败：${r.message||"服务器返回异常"}`);return}if(q.value=r.data,f.info("正在上传队员照片..."),!await M())return;f.info("正在提交报名信息...");const v=(await C.post("/team/add",{...o,workId:q.value})).data;v.code===200?(B({title:"提交成功",message:`报名成功！
您的作品ID为：${v.data}
请妥善保存该ID用于后续作品提交和查询`,type:"success",confirmButtonText:"确定"}).then(()=>{x()}).catch(()=>{x()}),w.value=q.value,U.value={}):f.error(`报名失败：${v.message||"服务器返回异常"}`)}catch(l){console.error("报名提交异常详情：",l);const r=l.response?.data?.message||l.message||"网络异常，报名失败";f.error(`报名失败：${r}`)}})},x=()=>{R.value.resetFields(),o.members=[{name:"",gender:"",college:"",majorGrade:"",studentType:"",phone:"",email:"",photoList:[]}],o.teacher1={name:"",gender:"",position:"",title:"",unit:"",email:"",phone:""},o.teacher2={name:"",gender:"",position:"",title:"",unit:"",email:"",phone:""},q.value="",U.value={}},O=async()=>{if(!w.value){f.warning("请输入作品ID后查询");return}N.value=!0,I.value=!1,d.value=null;try{const l=(await C.get("/team/queryByWorkId",{params:{workId:w.value}})).data;l.code===200?(d.value=l.data,I.value=!0,f.success("查询报名信息成功")):f.error(`查询失败：${l.message||"服务器返回异常"}`)}catch(m){console.error("查询报名信息异常：",m);const r=(m.response?.data||{}).message||"网络异常，查询失败";f.error(`查询失败：${r}`)}finally{N.value=!1}},S=()=>{w.value="",d.value=null,I.value=!1};return(m,l)=>{const r=V("el-input"),u=V("el-form-item"),i=V("el-button"),v=V("el-form"),s=V("el-descriptions-item"),_=V("el-descriptions"),c=V("el-table-column"),D=V("el-table"),z=V("el-card"),g=V("el-option"),T=V("el-select"),W=V("el-upload");return j(),k("div",J,[b("div",K,[b("div",X,[l[27]||(l[27]=b("h2",{class:"page-title"},"查询报名信息",-1)),e(z,{class:"apply-card query-card"},{default:a(()=>[e(v,{inline:"",class:"query-form"},{default:a(()=>[e(u,{label:"作品ID"},{default:a(()=>[e(r,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=t=>w.value=t),placeholder:"请输入作品ID查询报名信息",clearable:"",class:"query-input"},null,8,["modelValue"])]),_:1}),e(u,null,{default:a(()=>[e(i,{type:"primary",onClick:O,loading:N.value},{default:a(()=>[...l[20]||(l[20]=[n(" 查询 ",-1)])]),_:1},8,["loading"]),e(i,{onClick:S},{default:a(()=>[...l[21]||(l[21]=[n("清空",-1)])]),_:1})]),_:1})]),_:1}),I.value&&d.value?(j(),k("div",Y,[l[26]||(l[26]=b("h3",{class:"result-title"},"报名信息详情",-1)),e(_,{column:2,border:"",class:"result-desc"},{default:a(()=>[e(s,{label:"作品ID"},{default:a(()=>[n(p(d.value.workId),1)]),_:1}),e(s,{label:"参赛组别"},{default:a(()=>[n(p(d.value.groupType),1)]),_:1}),e(s,{label:"队伍名称"},{default:a(()=>[n(p(d.value.teamName),1)]),_:1}),e(s,{label:"项目名称"},{default:a(()=>[n(p(d.value.projectName),1)]),_:1}),e(s,{label:"报名学校"},{default:a(()=>[n(p(d.value.school),1)]),_:1}),e(s,{label:"参赛专业"},{default:a(()=>[n(p(d.value.major),1)]),_:1}),e(s,{label:"提交时间"},{default:a(()=>[n(p(d.value.createTime),1)]),_:1})]),_:1}),b("div",Z,[l[22]||(l[22]=b("h4",{class:"section-title"},"队员信息",-1)),e(D,{data:d.value.members,border:"",style:{width:"100%"},"empty-text":"暂无队员信息",class:"result-table"},{default:a(()=>[e(c,{label:"序号",align:"center",width:"80"},{default:a(t=>[n(p(t.$index+1),1)]),_:1}),e(c,{label:"姓名",prop:"name",width:"120"}),e(c,{label:"性别",prop:"gender",width:"100"}),e(c,{label:"学院",prop:"college","min-width":"150"}),e(c,{label:"专业/年级",prop:"majorGrade","min-width":"180"}),e(c,{label:"学生类型",prop:"studentType",width:"120"}),e(c,{label:"手机号码",prop:"phone","min-width":"150"}),e(c,{label:"电子邮箱",prop:"email","min-width":"200"})]),_:1},8,["data"])]),b("div",ee,[l[25]||(l[25]=b("h4",{class:"section-title"},"指导教师信息",-1)),d.value.teacher1?(j(),E(z,{key:0,class:"teacher-card-result"},{default:a(()=>[l[23]||(l[23]=b("h5",null,"指导教师1",-1)),e(_,{column:2,border:""},{default:a(()=>[e(s,{label:"姓名"},{default:a(()=>[n(p(d.value.teacher1.name),1)]),_:1}),e(s,{label:"性别"},{default:a(()=>[n(p(d.value.teacher1.gender),1)]),_:1}),e(s,{label:"职务"},{default:a(()=>[n(p(d.value.teacher1.position||"-"),1)]),_:1}),e(s,{label:"职称"},{default:a(()=>[n(p(d.value.teacher1.title||"-"),1)]),_:1}),e(s,{label:"单位"},{default:a(()=>[n(p(d.value.teacher1.unit),1)]),_:1}),e(s,{label:"手机号码"},{default:a(()=>[n(p(d.value.teacher1.phone),1)]),_:1}),e(s,{label:"电子邮箱",span:2},{default:a(()=>[n(p(d.value.teacher1.email||"-"),1)]),_:1})]),_:1})]),_:1})):$("",!0),d.value.teacher2&&d.value.teacher2.name?(j(),E(z,{key:1,class:"teacher-card-result",style:{"margin-top":"10px"}},{default:a(()=>[l[24]||(l[24]=b("h5",null,"指导教师2",-1)),e(_,{column:2,border:""},{default:a(()=>[e(s,{label:"姓名"},{default:a(()=>[n(p(d.value.teacher2.name),1)]),_:1}),e(s,{label:"性别"},{default:a(()=>[n(p(d.value.teacher2.gender),1)]),_:1}),e(s,{label:"职务"},{default:a(()=>[n(p(d.value.teacher2.position||"-"),1)]),_:1}),e(s,{label:"职称"},{default:a(()=>[n(p(d.value.teacher2.title||"-"),1)]),_:1}),e(s,{label:"单位"},{default:a(()=>[n(p(d.value.teacher2.unit),1)]),_:1}),e(s,{label:"手机号码"},{default:a(()=>[n(p(d.value.teacher2.phone),1)]),_:1}),e(s,{label:"电子邮箱",span:2},{default:a(()=>[n(p(d.value.teacher2.email||"-"),1)]),_:1})]),_:1})]),_:1})):$("",!0),!d.value.teacher1&&!d.value.teacher2?(j(),k("div",le,"暂无指导教师信息")):$("",!0)])])):$("",!0),I.value&&!d.value?(j(),k("div",ae," 未查询到该作品ID的报名信息，请检查作品ID是否正确 ")):$("",!0)]),_:1})])]),b("div",te,[l[34]||(l[34]=b("h2",{class:"page-title"},"大赛报名表",-1)),e(z,{class:"apply-card"},{default:a(()=>[e(v,{model:o,rules:L,ref_key:"applyFormRef",ref:R,"label-width":"120px",class:"apply-form"},{default:a(()=>[e(u,{label:"参赛组别",prop:"groupType"},{default:a(()=>[e(T,{modelValue:o.groupType,"onUpdate:modelValue":l[1]||(l[1]=t=>o.groupType=t),placeholder:"请选择参赛组别",class:"form-select"},{default:a(()=>[e(g,{label:"A、医学诊疗技术与器械组",value:"A"}),e(g,{label:"B、生物医学信息工程组",value:"B"}),e(g,{label:"C、生物材料与组织工程组",value:"C"}),e(g,{label:"D、其他",value:"D"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"队伍名称",prop:"teamName"},{default:a(()=>[e(r,{modelValue:o.teamName,"onUpdate:modelValue":l[2]||(l[2]=t=>o.teamName=t),placeholder:"请输入队伍名称（不超过20字）",class:"form-input"},null,8,["modelValue"])]),_:1}),e(u,{label:"项目名称",prop:"projectName"},{default:a(()=>[e(r,{modelValue:o.projectName,"onUpdate:modelValue":l[3]||(l[3]=t=>o.projectName=t),placeholder:"请输入参赛项目名称",class:"form-input"},null,8,["modelValue"])]),_:1}),e(u,{label:"报名学校",prop:"school"},{default:a(()=>[e(r,{modelValue:o.school,"onUpdate:modelValue":l[4]||(l[4]=t=>o.school=t),placeholder:"如：安徽医科大学",class:"form-input"},null,8,["modelValue"])]),_:1}),e(u,{label:"参赛专业",prop:"major"},{default:a(()=>[e(r,{modelValue:o.major,"onUpdate:modelValue":l[5]||(l[5]=t=>o.major=t),placeholder:"如：生物医学工程、医学信息工程",class:"form-input"},null,8,["modelValue"])]),_:1}),e(u,{label:"队员信息",prop:"members"},{default:a(()=>[b("div",oe,[e(D,{data:o.members,border:"",style:{width:"100%"},class:"member-table"},{default:a(()=>[e(c,{label:"序号",align:"center",width:"80"},{default:a(t=>[n(p(t.$index+1),1)]),_:1}),e(c,{label:"姓名",prop:"name",width:"120"},{default:a(t=>[e(r,{modelValue:t.row.name,"onUpdate:modelValue":h=>t.row.name=h,placeholder:"请输入姓名",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"性别",prop:"gender",width:"100"},{default:a(t=>[e(T,{modelValue:t.row.gender,"onUpdate:modelValue":h=>t.row.gender=h,placeholder:"请选择",size:"small"},{default:a(()=>[e(g,{label:"男",value:"男"}),e(g,{label:"女",value:"女"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"学院",prop:"college","min-width":"150"},{default:a(t=>[e(r,{modelValue:t.row.college,"onUpdate:modelValue":h=>t.row.college=h,placeholder:"请输入学院",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"专业/年级",prop:"majorGrade","min-width":"180"},{default:a(t=>[e(r,{modelValue:t.row.majorGrade,"onUpdate:modelValue":h=>t.row.majorGrade=h,placeholder:"如：医学信息工程/2023级",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"学生类型",prop:"studentType",width:"120"},{default:a(t=>[e(T,{modelValue:t.row.studentType,"onUpdate:modelValue":h=>t.row.studentType=h,placeholder:"请选择",size:"small"},{default:a(()=>[e(g,{label:"本科",value:"本科"}),e(g,{label:"硕",value:"硕"}),e(g,{label:"博",value:"博"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"手机号码",prop:"phone","min-width":"150"},{default:a(t=>[e(r,{modelValue:t.row.phone,"onUpdate:modelValue":h=>t.row.phone=h,placeholder:"请输入手机号",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"电子邮箱",prop:"email","min-width":"200"},{default:a(t=>[e(r,{modelValue:t.row.email,"onUpdate:modelValue":h=>t.row.email=h,placeholder:"请输入电子邮箱",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"学生证照片",prop:"studentIdPhoto","min-width":"200"},{default:a(t=>[e(W,{class:"upload-photo",action:re,"file-list":t.row.photoList,limit:1,"auto-upload":!0,"http-request":h=>A(h.file,t.$index),accept:"image/*"},{default:a(()=>[e(i,{size:"mini",type:"primary"},{default:a(()=>[...l[28]||(l[28]=[n("上传照片",-1)])]),_:1})]),_:1},8,["file-list","http-request"])]),_:1}),e(c,{label:"操作",width:"100",align:"center"},{default:a(t=>[e(i,{type:"danger",size:"mini",onClick:h=>F(t.$index),disabled:o.members.length<=1},{default:a(()=>[...l[29]||(l[29]=[n(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),e(i,{type:"primary",size:"small",onClick:G,style:{"margin-top":"10px"}},{default:a(()=>[...l[30]||(l[30]=[n(" 添加队员 ",-1)])]),_:1}),l[31]||(l[31]=b("div",{class:"form-tip"}," 注：每队最少1人，最多5人，指导老师最多2人；每人需上传学生证照片（清晰可辨） ",-1))]),_:1}),e(u,{label:"指导教师1",prop:"teacher1.name"},{default:a(()=>[e(z,{shadow:"hover",class:"teacher-card"},{default:a(()=>[e(v,{model:o.teacher1,"label-width":"100px"},{default:a(()=>[e(u,{label:"姓名",prop:"name"},{default:a(()=>[e(r,{modelValue:o.teacher1.name,"onUpdate:modelValue":l[6]||(l[6]=t=>o.teacher1.name=t),placeholder:"请输入指导教师姓名",size:"small"},null,8,["modelValue"])]),_:1}),e(u,{label:"性别",prop:"gender"},{default:a(()=>[e(T,{modelValue:o.teacher1.gender,"onUpdate:modelValue":l[7]||(l[7]=t=>o.teacher1.gender=t),placeholder:"请选择",size:"small"},{default:a(()=>[e(g,{label:"男",value:"男"}),e(g,{label:"女",value:"女"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"职务",prop:"position"},{default:a(()=>[e(r,{modelValue:o.teacher1.position,"onUpdate:modelValue":l[8]||(l[8]=t=>o.teacher1.position=t),placeholder:"如：教授、讲师",size:"small"},null,8,["modelValue"])]),_:1}),e(u,{label:"职称",prop:"title"},{default:a(()=>[e(r,{modelValue:o.teacher1.title,"onUpdate:modelValue":l[9]||(l[9]=t=>o.teacher1.title=t),placeholder:"如：博士生导师",size:"small"},null,8,["modelValue"])]),_:1}),e(u,{label:"单位",prop:"unit"},{default:a(()=>[e(r,{modelValue:o.teacher1.unit,"onUpdate:modelValue":l[10]||(l[10]=t=>o.teacher1.unit=t),placeholder:"如：安徽医科大学生物医学工程学院",size:"small"},null,8,["modelValue"])]),_:1}),e(u,{label:"电子邮箱",prop:"email"},{default:a(()=>[e(r,{modelValue:o.teacher1.email,"onUpdate:modelValue":l[11]||(l[11]=t=>o.teacher1.email=t),placeholder:"请输入电子邮箱",size:"small"},null,8,["modelValue"])]),_:1}),e(u,{label:"手机号码",prop:"phone"},{default:a(()=>[e(r,{modelValue:o.teacher1.phone,"onUpdate:modelValue":l[12]||(l[12]=t=>o.teacher1.phone=t),placeholder:"请输入手机号码",size:"small"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(u,{label:"指导教师2（可选）",prop:"teacher2.name"},{default:a(()=>[e(z,{shadow:"hover",class:"teacher-card"},{default:a(()=>[e(v,{model:o.teacher2,"label-width":"100px"},{default:a(()=>[e(u,{label:"姓名",prop:"name"},{default:a(()=>[e(r,{modelValue:o.teacher2.name,"onUpdate:modelValue":l[13]||(l[13]=t=>o.teacher2.name=t),placeholder:"请输入指导教师姓名",size:"small"},null,8,["modelValue"])]),_:1}),e(u,{label:"性别",prop:"gender"},{default:a(()=>[e(T,{modelValue:o.teacher2.gender,"onUpdate:modelValue":l[14]||(l[14]=t=>o.teacher2.gender=t),placeholder:"请选择",size:"small"},{default:a(()=>[e(g,{label:"男",value:"男"}),e(g,{label:"女",value:"女"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"职务",prop:"position"},{default:a(()=>[e(r,{modelValue:o.teacher2.position,"onUpdate:modelValue":l[15]||(l[15]=t=>o.teacher2.position=t),placeholder:"如：教授、讲师",size:"small"},null,8,["modelValue"])]),_:1}),e(u,{label:"职称",prop:"title"},{default:a(()=>[e(r,{modelValue:o.teacher2.title,"onUpdate:modelValue":l[16]||(l[16]=t=>o.teacher2.title=t),placeholder:"如：博士生导师",size:"small"},null,8,["modelValue"])]),_:1}),e(u,{label:"单位",prop:"unit"},{default:a(()=>[e(r,{modelValue:o.teacher2.unit,"onUpdate:modelValue":l[17]||(l[17]=t=>o.teacher2.unit=t),placeholder:"如：安徽医科大学生物医学工程学院",size:"small"},null,8,["modelValue"])]),_:1}),e(u,{label:"电子邮箱",prop:"email"},{default:a(()=>[e(r,{modelValue:o.teacher2.email,"onUpdate:modelValue":l[18]||(l[18]=t=>o.teacher2.email=t),placeholder:"请输入电子邮箱",size:"small"},null,8,["modelValue"])]),_:1}),e(u,{label:"手机号码",prop:"phone"},{default:a(()=>[e(r,{modelValue:o.teacher2.phone,"onUpdate:modelValue":l[19]||(l[19]=t=>o.teacher2.phone=t),placeholder:"请输入手机号码",size:"small"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(u,{class:"form-btn-group"},{default:a(()=>[e(i,{type:"primary",size:"default",onClick:P},{default:a(()=>[...l[32]||(l[32]=[n("提交报名",-1)])]),_:1}),e(i,{size:"default",onClick:x},{default:a(()=>[...l[33]||(l[33]=[n("重置表单",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])}}},ne=Q(ue,[["__scopeId","data-v-c62bc9bc"]]);export{ne as default};
