import{_ as S,c as k,a as h,b as e,w as a,r as V,o as w,d as s,t as m,h as B,j as T,e as U,E as i,k as C,i as H,l as G}from"./index-DoGM4jZS.js";const K={class:"apply-page"},O={class:"query-container"},X={class:"apply-container"},Y={key:0,class:"query-result"},Z={class:"result-section"},ee={class:"result-section"},le={key:2,class:"empty-tip"},ae={key:1,class:"empty-result"},te={class:"apply-container"},oe={class:"member-table-wrap"},j="http://localhost:8080/api",re={__name:"ApplyView",setup(de){const z=U(""),v=U(""),u=U(null),x=U(!1),$=U(!1),o=H({groupType:"",teamName:"",projectName:"",school:"",major:"",members:[{name:"",gender:"",college:"",majorGrade:"",studentType:"",phone:"",email:"",photoList:[]}],teacher1:{name:"",gender:"",position:"",title:"",unit:"",email:"",phone:""},teacher2:{name:"",gender:"",position:"",title:"",unit:"",email:"",phone:""},workId:"",createTime:"",membersJson:"",teacher1Json:"",teacher2Json:""}),R={groupType:[{required:!0,message:"请选择参赛组别",trigger:"change"}],teamName:[{required:!0,message:"请输入队伍名称",trigger:"blur"}],projectName:[{required:!0,message:"请输入项目名称",trigger:"blur"}],school:[{required:!0,message:"请输入报名学校",trigger:"blur"}],major:[{required:!0,message:"请输入参赛专业",trigger:"blur"}],members:[{required:!0,validator:(f,l,r)=>{let d=!0;if(l.forEach((n,_)=>{n.name?!n.phone||!/^1[3-9]\d{9}$/.test(n.phone)?(r(new Error(`第${_+1}名队员手机号不能为空且格式正确`)),d=!1):!n.gender||!n.college||!n.majorGrade||!n.studentType?(r(new Error(`请完善第${_+1}名队员的所有必填信息`)),d=!1):n.photoList.length===0&&(r(new Error(`第${_+1}名队员需上传学生证照片`)),d=!1):(r(new Error(`第${_+1}名队员姓名不能为空`)),d=!1)}),!d)return;if(l.length<1){r(new Error("参赛队员至少需要1人"));return}let b=0;if(o.teacher1.name&&b++,o.teacher2.name&&b++,b<1){r(new Error("至少需要填写1位指导教师的姓名"));return}if(l.length+b>5){r(new Error(`队员(${l.length}人)+指导教师(${b}人)总人数不能超过5人`));return}r()},trigger:"change"}],"teacher1.name":[{required:!0,message:"请输入指导教师1姓名",trigger:"blur"}],"teacher1.gender":[{required:!0,message:"请选择指导教师1性别",trigger:"change"}],"teacher1.unit":[{required:!0,message:"请输入指导教师1单位",trigger:"blur"}],"teacher1.phone":[{required:!0,message:"请输入指导教师1电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},N=U(null),L=`${j}/file/upload`,A=()=>{const f=(o.teacher1.name?1:0)+(o.teacher2.name?1:0);if(o.members.length+f>=5){i.warning("队员+指导教师总人数不能超过5人，无法新增队员");return}if(o.members.length>=5){i.warning("每队最多5名队员");return}o.members.push({name:"",gender:"",college:"",majorGrade:"",studentType:"",phone:"",email:"",photoList:[]})},F=f=>{G.confirm("确定要删除该队员吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.members.splice(f,1),i.success("队员删除成功")}).catch(()=>{i.info("已取消删除")})},M=async(f,l)=>{if(!f)return i.error("请选择要上传的照片"),!1;const r=new FormData;r.append("file",f),r.append("workId",z.value);try{const d=await C.post(`${j}/file/upload`,r,{headers:{"Content-Type":"multipart/form-data"}});return d.code===200?(o.members[l].photoList=[d.data],i.success("学生证照片上传成功"),!0):(i.error(`照片上传失败：${d.message}`),!1)}catch(d){return i.error(`照片上传失败：${d.response?.data?.message||"网络异常"}`),!1}},J=()=>{N.value.validate(async f=>{if(!f){i.error("请完善表单必填信息");return}try{i.info("正在生成作品ID...");const l=await C.get(`${j}/team/generateWorkId`);if(l.code!==200){i.error(`作品ID生成失败：${l.message}`);return}z.value=l.data,o.workId=z.value;const r=await C.post(`${j}/team/add`,o);r.code===200?(G.success(`报名成功！
您的作品ID为：${r.data}
请妥善保存该ID用于后续作品提交和查询`,"提交成功",{confirmButtonText:"确定",callback:()=>D()}),v.value=z.value):i.error(`报名失败：${r.message}`)}catch(l){const r=l.response?.data?.message||"网络异常，报名失败";i.error(r)}})},D=()=>{N.value.resetFields(),o.members=[{name:"",gender:"",college:"",majorGrade:"",studentType:"",phone:"",email:"",photoList:[]}],o.teacher1={name:"",gender:"",position:"",title:"",unit:"",email:"",phone:""},o.teacher2={name:"",gender:"",position:"",title:"",unit:"",email:"",phone:""},z.value="",o.workId=""},W=async()=>{if(!v.value){i.warning("请输入作品ID后查询");return}x.value=!0,$.value=!1,u.value=null;try{const f=await C.get(`${j}/team/queryByWorkId`,{params:{workId:v.value}});f.code===200?(u.value=f.data,$.value=!0,i.success("查询报名信息成功")):i.error(`查询失败：${f.message}`)}catch(f){const l=f.response?.data?.message||"网络异常，查询失败";i.error(l)}finally{x.value=!1}},P=()=>{v.value="",u.value=null,$.value=!1};return(f,l)=>{const r=V("el-input"),d=V("el-form-item"),b=V("el-button"),q=V("el-form"),n=V("el-descriptions-item"),_=V("el-descriptions"),p=V("el-table-column"),E=V("el-table"),y=V("el-card"),g=V("el-option"),I=V("el-select"),Q=V("el-upload");return w(),k("div",K,[h("div",O,[h("div",X,[l[27]||(l[27]=h("h2",{class:"page-title"},"查询报名信息",-1)),e(y,{class:"apply-card query-card"},{default:a(()=>[e(q,{inline:"",class:"query-form"},{default:a(()=>[e(d,{label:"作品ID"},{default:a(()=>[e(r,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=t=>v.value=t),placeholder:"请输入作品ID查询报名信息",clearable:"",class:"query-input"},null,8,["modelValue"])]),_:1}),e(d,null,{default:a(()=>[e(b,{type:"primary",onClick:W,loading:x.value},{default:a(()=>[...l[20]||(l[20]=[s(" 查询 ",-1)])]),_:1},8,["loading"]),e(b,{onClick:P},{default:a(()=>[...l[21]||(l[21]=[s("清空",-1)])]),_:1})]),_:1})]),_:1}),$.value&&u.value?(w(),k("div",Y,[l[26]||(l[26]=h("h3",{class:"result-title"},"报名信息详情",-1)),e(_,{column:2,border:"",class:"result-desc"},{default:a(()=>[e(n,{label:"作品ID"},{default:a(()=>[s(m(u.value.workId),1)]),_:1}),e(n,{label:"参赛组别"},{default:a(()=>[s(m(u.value.groupType),1)]),_:1}),e(n,{label:"队伍名称"},{default:a(()=>[s(m(u.value.teamName),1)]),_:1}),e(n,{label:"项目名称"},{default:a(()=>[s(m(u.value.projectName),1)]),_:1}),e(n,{label:"报名学校"},{default:a(()=>[s(m(u.value.school),1)]),_:1}),e(n,{label:"参赛专业"},{default:a(()=>[s(m(u.value.major),1)]),_:1}),e(n,{label:"提交时间"},{default:a(()=>[s(m(u.value.createTime),1)]),_:1})]),_:1}),h("div",Z,[l[22]||(l[22]=h("h4",{class:"section-title"},"队员信息",-1)),e(E,{data:u.value.members,border:"",style:{width:"100%"},"empty-text":"暂无队员信息",class:"result-table"},{default:a(()=>[e(p,{label:"序号",align:"center",width:"80"},{default:a(t=>[s(m(t.$index+1),1)]),_:1}),e(p,{label:"姓名",prop:"name",width:"120"}),e(p,{label:"性别",prop:"gender",width:"100"}),e(p,{label:"学院",prop:"college","min-width":"150"}),e(p,{label:"专业/年级",prop:"majorGrade","min-width":"180"}),e(p,{label:"学生类型",prop:"studentType",width:"120"}),e(p,{label:"手机号码",prop:"phone","min-width":"150"}),e(p,{label:"电子邮箱",prop:"email","min-width":"200"})]),_:1},8,["data"])]),h("div",ee,[l[25]||(l[25]=h("h4",{class:"section-title"},"指导教师信息",-1)),u.value.teacher1?(w(),B(y,{key:0,class:"teacher-card-result"},{default:a(()=>[l[23]||(l[23]=h("h5",null,"指导教师1",-1)),e(_,{column:2,border:""},{default:a(()=>[e(n,{label:"姓名"},{default:a(()=>[s(m(u.value.teacher1.name),1)]),_:1}),e(n,{label:"性别"},{default:a(()=>[s(m(u.value.teacher1.gender),1)]),_:1}),e(n,{label:"职务"},{default:a(()=>[s(m(u.value.teacher1.position||"-"),1)]),_:1}),e(n,{label:"职称"},{default:a(()=>[s(m(u.value.teacher1.title||"-"),1)]),_:1}),e(n,{label:"单位"},{default:a(()=>[s(m(u.value.teacher1.unit),1)]),_:1}),e(n,{label:"手机号码"},{default:a(()=>[s(m(u.value.teacher1.phone),1)]),_:1}),e(n,{label:"电子邮箱",span:2},{default:a(()=>[s(m(u.value.teacher1.email||"-"),1)]),_:1})]),_:1})]),_:1})):T("",!0),u.value.teacher2&&u.value.teacher2.name?(w(),B(y,{key:1,class:"teacher-card-result",style:{"margin-top":"10px"}},{default:a(()=>[l[24]||(l[24]=h("h5",null,"指导教师2",-1)),e(_,{column:2,border:""},{default:a(()=>[e(n,{label:"姓名"},{default:a(()=>[s(m(u.value.teacher2.name),1)]),_:1}),e(n,{label:"性别"},{default:a(()=>[s(m(u.value.teacher2.gender),1)]),_:1}),e(n,{label:"职务"},{default:a(()=>[s(m(u.value.teacher2.position||"-"),1)]),_:1}),e(n,{label:"职称"},{default:a(()=>[s(m(u.value.teacher2.title||"-"),1)]),_:1}),e(n,{label:"单位"},{default:a(()=>[s(m(u.value.teacher2.unit),1)]),_:1}),e(n,{label:"手机号码"},{default:a(()=>[s(m(u.value.teacher2.phone),1)]),_:1}),e(n,{label:"电子邮箱",span:2},{default:a(()=>[s(m(u.value.teacher2.email||"-"),1)]),_:1})]),_:1})]),_:1})):T("",!0),!u.value.teacher1&&!u.value.teacher2?(w(),k("div",le,"暂无指导教师信息")):T("",!0)])])):T("",!0),$.value&&!u.value?(w(),k("div",ae," 未查询到该作品ID的报名信息，请检查作品ID是否正确 ")):T("",!0)]),_:1})])]),h("div",te,[l[34]||(l[34]=h("h2",{class:"page-title"},"大赛报名表",-1)),e(y,{class:"apply-card"},{default:a(()=>[e(q,{model:o,rules:R,ref_key:"applyFormRef",ref:N,"label-width":"120px",class:"apply-form"},{default:a(()=>[e(d,{label:"参赛组别",prop:"groupType"},{default:a(()=>[e(I,{modelValue:o.groupType,"onUpdate:modelValue":l[1]||(l[1]=t=>o.groupType=t),placeholder:"请选择参赛组别",class:"form-select"},{default:a(()=>[e(g,{label:"A、医学诊疗技术与器械组",value:"A"}),e(g,{label:"B、生物医学信息工程组",value:"B"}),e(g,{label:"C、生物材料与组织工程组",value:"C"}),e(g,{label:"D、其他",value:"D"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"队伍名称",prop:"teamName"},{default:a(()=>[e(r,{modelValue:o.teamName,"onUpdate:modelValue":l[2]||(l[2]=t=>o.teamName=t),placeholder:"请输入队伍名称（不超过20字）",class:"form-input"},null,8,["modelValue"])]),_:1}),e(d,{label:"项目名称",prop:"projectName"},{default:a(()=>[e(r,{modelValue:o.projectName,"onUpdate:modelValue":l[3]||(l[3]=t=>o.projectName=t),placeholder:"请输入参赛项目名称",class:"form-input"},null,8,["modelValue"])]),_:1}),e(d,{label:"报名学校",prop:"school"},{default:a(()=>[e(r,{modelValue:o.school,"onUpdate:modelValue":l[4]||(l[4]=t=>o.school=t),placeholder:"如：安徽医科大学",class:"form-input"},null,8,["modelValue"])]),_:1}),e(d,{label:"参赛专业",prop:"major"},{default:a(()=>[e(r,{modelValue:o.major,"onUpdate:modelValue":l[5]||(l[5]=t=>o.major=t),placeholder:"如：生物医学工程、医学信息工程",class:"form-input"},null,8,["modelValue"])]),_:1}),e(d,{label:"队员信息",prop:"members"},{default:a(()=>[h("div",oe,[e(E,{data:o.members,border:"",style:{width:"100%"},class:"member-table"},{default:a(()=>[e(p,{label:"序号",align:"center",width:"80"},{default:a(t=>[s(m(t.$index+1),1)]),_:1}),e(p,{label:"姓名",prop:"name",width:"120"},{default:a(t=>[e(r,{modelValue:t.row.name,"onUpdate:modelValue":c=>t.row.name=c,placeholder:"请输入姓名",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(p,{label:"性别",prop:"gender",width:"100"},{default:a(t=>[e(I,{modelValue:t.row.gender,"onUpdate:modelValue":c=>t.row.gender=c,placeholder:"请选择",size:"small"},{default:a(()=>[e(g,{label:"男",value:"男"}),e(g,{label:"女",value:"女"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(p,{label:"学院",prop:"college","min-width":"150"},{default:a(t=>[e(r,{modelValue:t.row.college,"onUpdate:modelValue":c=>t.row.college=c,placeholder:"请输入学院",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(p,{label:"专业/年级",prop:"majorGrade","min-width":"180"},{default:a(t=>[e(r,{modelValue:t.row.majorGrade,"onUpdate:modelValue":c=>t.row.majorGrade=c,placeholder:"如：医学信息工程/2023级",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(p,{label:"学生类型",prop:"studentType",width:"120"},{default:a(t=>[e(I,{modelValue:t.row.studentType,"onUpdate:modelValue":c=>t.row.studentType=c,placeholder:"请选择",size:"small"},{default:a(()=>[e(g,{label:"本科",value:"本科"}),e(g,{label:"硕",value:"硕"}),e(g,{label:"博",value:"博"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(p,{label:"手机号码",prop:"phone","min-width":"150"},{default:a(t=>[e(r,{modelValue:t.row.phone,"onUpdate:modelValue":c=>t.row.phone=c,placeholder:"请输入手机号",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(p,{label:"电子邮箱",prop:"email","min-width":"200"},{default:a(t=>[e(r,{modelValue:t.row.email,"onUpdate:modelValue":c=>t.row.email=c,placeholder:"请输入电子邮箱",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(p,{label:"学生证照片",prop:"studentIdPhoto","min-width":"200"},{default:a(t=>[e(Q,{class:"upload-photo",action:L,"file-list":t.row.photoList,limit:1,"auto-upload":!0,"http-request":c=>M(c.file,t.$index),accept:"image/*"},{default:a(()=>[e(b,{size:"mini",type:"primary"},{default:a(()=>[...l[28]||(l[28]=[s("上传照片",-1)])]),_:1})]),_:1},8,["file-list","http-request"])]),_:1}),e(p,{label:"操作",width:"100",align:"center"},{default:a(t=>[e(b,{type:"danger",size:"mini",onClick:c=>F(t.$index),disabled:o.members.length<=1},{default:a(()=>[...l[29]||(l[29]=[s(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),e(b,{type:"primary",size:"small",onClick:A,style:{"margin-top":"10px"}},{default:a(()=>[...l[30]||(l[30]=[s(" 添加队员 ",-1)])]),_:1}),l[31]||(l[31]=h("div",{class:"form-tip"}," 注：每队最少1人，最多5人；每人需上传学生证照片（清晰可辨） ",-1))]),_:1}),e(d,{label:"指导教师1",prop:"teacher1.name"},{default:a(()=>[e(y,{shadow:"hover",class:"teacher-card"},{default:a(()=>[e(q,{model:o.teacher1,"label-width":"100px"},{default:a(()=>[e(d,{label:"姓名",prop:"name"},{default:a(()=>[e(r,{modelValue:o.teacher1.name,"onUpdate:modelValue":l[6]||(l[6]=t=>o.teacher1.name=t),placeholder:"请输入指导教师姓名",size:"small"},null,8,["modelValue"])]),_:1}),e(d,{label:"性别",prop:"gender"},{default:a(()=>[e(I,{modelValue:o.teacher1.gender,"onUpdate:modelValue":l[7]||(l[7]=t=>o.teacher1.gender=t),placeholder:"请选择",size:"small"},{default:a(()=>[e(g,{label:"男",value:"男"}),e(g,{label:"女",value:"女"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"职务",prop:"position"},{default:a(()=>[e(r,{modelValue:o.teacher1.position,"onUpdate:modelValue":l[8]||(l[8]=t=>o.teacher1.position=t),placeholder:"如：教授、讲师",size:"small"},null,8,["modelValue"])]),_:1}),e(d,{label:"职称",prop:"title"},{default:a(()=>[e(r,{modelValue:o.teacher1.title,"onUpdate:modelValue":l[9]||(l[9]=t=>o.teacher1.title=t),placeholder:"如：博士生导师",size:"small"},null,8,["modelValue"])]),_:1}),e(d,{label:"单位",prop:"unit"},{default:a(()=>[e(r,{modelValue:o.teacher1.unit,"onUpdate:modelValue":l[10]||(l[10]=t=>o.teacher1.unit=t),placeholder:"如：安徽医科大学生物医学工程学院",size:"small"},null,8,["modelValue"])]),_:1}),e(d,{label:"电子邮箱",prop:"email"},{default:a(()=>[e(r,{modelValue:o.teacher1.email,"onUpdate:modelValue":l[11]||(l[11]=t=>o.teacher1.email=t),placeholder:"请输入电子邮箱",size:"small"},null,8,["modelValue"])]),_:1}),e(d,{label:"手机号码",prop:"phone"},{default:a(()=>[e(r,{modelValue:o.teacher1.phone,"onUpdate:modelValue":l[12]||(l[12]=t=>o.teacher1.phone=t),placeholder:"请输入手机号码",size:"small"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(d,{label:"指导教师2（可选）",prop:"teacher2.name"},{default:a(()=>[e(y,{shadow:"hover",class:"teacher-card"},{default:a(()=>[e(q,{model:o.teacher2,"label-width":"100px"},{default:a(()=>[e(d,{label:"姓名",prop:"name"},{default:a(()=>[e(r,{modelValue:o.teacher2.name,"onUpdate:modelValue":l[13]||(l[13]=t=>o.teacher2.name=t),placeholder:"请输入指导教师姓名",size:"small"},null,8,["modelValue"])]),_:1}),e(d,{label:"性别",prop:"gender"},{default:a(()=>[e(I,{modelValue:o.teacher2.gender,"onUpdate:modelValue":l[14]||(l[14]=t=>o.teacher2.gender=t),placeholder:"请选择",size:"small"},{default:a(()=>[e(g,{label:"男",value:"男"}),e(g,{label:"女",value:"女"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"职务",prop:"position"},{default:a(()=>[e(r,{modelValue:o.teacher2.position,"onUpdate:modelValue":l[15]||(l[15]=t=>o.teacher2.position=t),placeholder:"如：教授、讲师",size:"small"},null,8,["modelValue"])]),_:1}),e(d,{label:"职称",prop:"title"},{default:a(()=>[e(r,{modelValue:o.teacher2.title,"onUpdate:modelValue":l[16]||(l[16]=t=>o.teacher2.title=t),placeholder:"如：博士生导师",size:"small"},null,8,["modelValue"])]),_:1}),e(d,{label:"单位",prop:"unit"},{default:a(()=>[e(r,{modelValue:o.teacher2.unit,"onUpdate:modelValue":l[17]||(l[17]=t=>o.teacher2.unit=t),placeholder:"如：安徽医科大学生物医学工程学院",size:"small"},null,8,["modelValue"])]),_:1}),e(d,{label:"电子邮箱",prop:"email"},{default:a(()=>[e(r,{modelValue:o.teacher2.email,"onUpdate:modelValue":l[18]||(l[18]=t=>o.teacher2.email=t),placeholder:"请输入电子邮箱",size:"small"},null,8,["modelValue"])]),_:1}),e(d,{label:"手机号码",prop:"phone"},{default:a(()=>[e(r,{modelValue:o.teacher2.phone,"onUpdate:modelValue":l[19]||(l[19]=t=>o.teacher2.phone=t),placeholder:"请输入手机号码",size:"small"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(d,{class:"form-btn-group"},{default:a(()=>[e(b,{type:"primary",size:"default",onClick:J},{default:a(()=>[...l[32]||(l[32]=[s("提交报名",-1)])]),_:1}),e(b,{size:"default",onClick:D},{default:a(()=>[...l[33]||(l[33]=[s("重置表单",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])}}},ne=S(re,[["__scopeId","data-v-e234d291"]]);export{ne as default};
