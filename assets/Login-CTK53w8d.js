import{_ as w,e as y,c as v,a as i,b as s,w as l,n as x,m as k,r as d,p as V,o as T,d as b,l as B,j as I,E as r,i as S}from"./index-DWDpl3uH.js";import{i as E}from"./jwtUtil-DU9BCR_A.js";const h={class:"admin-login-container"},q={class:"login-card"},M={__name:"Login",setup(N){const c=V(),u=I(!1),a=B({username:"",password:""}),p=async()=>{if(!a.username)return r.warning("请输入管理员账号");if(!a.password)return r.warning("请输入管理员密码");u.value=!0;try{const o=await S.post("/admin/login",{username:a.username,password:a.password});if(o.code!==200){r.error(o.message||"登录失败，请检查账号密码");return}const{token:e,user:t}=o.data||{};if(!e||!t){r.error("登录失败：未获取到登录凭证");return}localStorage.setItem("adminToken",e),localStorage.setItem("adminUser",JSON.stringify(t)),r.success("登录成功！");const n=c.currentRoute.query?.redirect||"/admin";await c.replace(n)}catch(o){let e="账号或密码错误";o.response&&(o.response.status===404?e="登录接口不存在，请检查后端地址":o.response.status===500?e="服务器错误，请联系管理员":e=o.response.data?.message||"登录失败"),r.error(`登录失败：${e}`)}finally{u.value=!1}},f=async()=>{const o=localStorage.getItem("adminToken");if(o&&!E(o))try{await k.confirm("检测到您已登录，是否直接进入管理后台？","登录状态检测",{confirmButtonText:"进入后台",cancelButtonText:"重新登录",type:"info"}),await c.replace("/admin")}catch{localStorage.removeItem("adminToken"),localStorage.removeItem("adminUser")}};return y(()=>{f()}),(o,e)=>{const t=d("el-input"),n=d("el-form-item"),g=d("el-button"),_=d("el-form");return T(),v("div",h,[i("div",q,[e[3]||(e[3]=i("div",{class:"login-header"},[i("h2",null,"大赛管理系统 - 管理员登录"),i("p",null,"请输入管理员账号密码登录后台")],-1)),s(_,{model:a,class:"login-form",onKeyup:x(p,["enter"])},{default:l(()=>[s(n,{label:"账号",required:""},{default:l(()=>[s(t,{modelValue:a.username,"onUpdate:modelValue":e[0]||(e[0]=m=>a.username=m),placeholder:"请输入管理员账号","prefix-icon":"el-icon-user",size:"large",autofocus:""},null,8,["modelValue"])]),_:1}),s(n,{label:"密码",required:""},{default:l(()=>[s(t,{modelValue:a.password,"onUpdate:modelValue":e[1]||(e[1]=m=>a.password=m),type:"password",placeholder:"请输入管理员密码","prefix-icon":"el-icon-lock",size:"large"},null,8,["modelValue"])]),_:1}),s(n,null,{default:l(()=>[s(g,{type:"primary",size:"large",class:"login-btn",onClick:p,loading:u.value},{default:l(()=>[...e[2]||(e[2]=[b(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}},C=w(M,[["__scopeId","data-v-5953fd45"]]);export{C as default};
